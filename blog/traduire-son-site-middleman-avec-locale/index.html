<!DOCTYPE html> <html> <head> <title>Traduire son site Middleman avec Locale</title> <meta charset=UTF-8> <meta content='Pour traduire nos sites en Rails, on utilise pratiquement tout le temps le SaaS de localisation Locale. On va voir comment s'en servir dans un projet Middleman, pour une fois.' name=description> <meta content='width=device-width, initial-scale=1.0, user-scalable=no' name=viewport> <meta content='Traduire son site Middleman avec Locale' property='og:title'> <meta content='Pour traduire nos sites en Rails, on utilise pratiquement tout le temps le SaaS de localisation Locale. On va voir comment s'en servir dans un projet Middleman, pour une fois.' property='og:description'> <meta content=fr_FR property='og:locale'> <meta content='Alpine Lab' property='og:site_name'> <meta content='https://www.alpine-lab.com/blog/traduire-son-site-middleman-avec-locale/' property='og:url'> <meta content='https://www.alpine-lab.com/images/logo-alpinelab-500-cebd1677.png' property='og:image'> <meta content=article property='og:type'> <link href='/apple-touch-icon-180x180-precomposed.png' rel=apple-touch-icon sizes=180x180> <link href='/apple-touch-icon-152x152-precomposed.png' rel=apple-touch-icon sizes=152x152> <link href='/apple-touch-icon-144x144-precomposed.png' rel=apple-touch-icon sizes=144x144> <link href='/apple-touch-icon-114x114-precomposed.png' rel=apple-touch-icon sizes=114x114> <link href='/apple-touch-icon-72x72-precomposed.png' rel=apple-touch-icon sizes=72x72> <link href='/apple-touch-icon-precomposed.png' rel=apple-touch-icon> <link href='/favicon.png' rel='shortcut icon'> <link href='/favicon.ico' rel=icon type='image/ico'> <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700%7CMontserrat:400,700' rel=stylesheet> <link href="/stylesheets/blog-4694b20b.css" rel=stylesheet /> <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.min.css" rel=stylesheet /> </head> <body class='blog blog_traduire-son-site-middleman-avec-locale blog_traduire-son-site-middleman-avec-locale_index'> <meta content='Alpine Lab, blog technique' itemprop=name> <meta content='On parle de développement web, d&#39;entreprenariat, de Ruby/Rails, de Haml/Slim, de Sass, de CoffeeScript et d&#39;Ember.js' itemprop=description> <meta content='https://www.alpine-lab.com/blog' itemprop=url> <meta content=fr itemprop=inLanguage> <meta content='https://www.alpine-lab.com/images/logo-alpinelab-500-cebd1677.png' itemprop=image> <div id=wrapper> <header> <a href="/blog"><div class=logo></div> <h1 class=sitename><span class=alpine>Alpine</span><span class=lab>Lab</span> <span class=blog>blog technique</span> </h1> </a><div class=social-networks> <a href="https://github.com/alpinelab" target=_blank><i class='fa fa-github'></i> </a><a href="https://twitter.com/alpinelab" target=_blank><i class='fa fa-twitter'></i> </a></div> </header> <div id=main> <article itemscope itemtype='http://schema.org/BlogPosting'> <meta content='Pour traduire nos sites en Rails, on utilise pratiquement tout le temps le SaaS de localisation Locale. On va voir comment s&#39;en servir dans un projet Middleman, pour une fois.' itemprop=description> <meta content='https://www.alpine-lab.com/blog/traduire-son-site-middleman-avec-locale/' itemprop=url> <meta content=fr itemprop=inLanguage> <h1 itemprop='name headline'>Traduire son site Middleman avec Locale</h1> <time class=published datetime=2013-07-03 itemprop=datePublished> Publié le 03/07/2013 </time> <ul class=tags> <li> <i class='fa fa-tags'></i> </li> <li><a href="/blog/tags/middleman/">Middleman</a></li> <li><a href="/blog/tags/locale/">Locale</a></li> <li><a href="/blog/tags/i18n/">I18n</a></li> </ul> <div class=post-body itemprop=articleBody><p>Pour traduire nos sites en Rails, on utilise pratiquement tout le temps le SaaS de localisation <a href="http://www.localeapp.com">Locale</a>. On va voir comment s&#39;en servir dans un projet Middleman, pour une fois.</p> <p>Pour ceux qui ne connaissent pas, on en profite pour faire un peu de pub, parce que c&#39;est <a href="https://github.com/tigrish">notre pote Chris</a> qui le développe et que, nous même, on bosse de temps en temps sur ce projet. Sachez donc que c&#39;est un service qui permet de ne plus se galérer avec les fichiers de traduction Yaml de Rails, mais plutôt d&#39;utiliser cette superbe interface de traduction, directement depuis votre navigateur :</p> <p><img title=Locale alt=Locale width=1138 height=414 src="/images/blog/locale-01-interface-8025034b.png"/></p> <p>Il y a plein d&#39;autres fonctionnalités (commande de traductions, workflows, synchronisation, &hellip;) que je vous laisse découvrir <a href="http://www.localeapp.com/users/sign_up">en essayant par vous même</a>.</p> <p>Bref, c&#39;est bien beau tout ça, mais comment on s&#39;en sert avec Middleman ?</p> <h2 id=installation-de-la-gem>Installation de la gem</h2> <p>Locale s&#39;installe par une gem. Comme Middleman fonctionne à base de fichier <code>Gemfile</code>, il suffit d&#39;y ajouter :</p> <div class=highlight><pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'localeapp'</span>&#x000A;</code></pre></div> <p>Puis d&#39;éxecuter le classique :</p> <div class=highlight><pre class="highlight shell"><code><span class="nv">$ </span>bundle <span class="nb">install</span>&#x000A;</code></pre></div> <p>Splendide.</p> <h2 id=cr-ation-dun-projet-locale-et-liaison-avec-le-projet-middleman>Création d&#39;un projet Locale et liaison avec le projet Middleman</h2> <p>Une fois loggé(e) sur le site de Locale, cliquez sur le bouton &ldquo;+&rdquo; pour créer un projet.</p> <p><img title="Locale - Add project" alt="Locale - Add project" width=1138 height=618 src="/images/blog/locale-02-add-project-8b9965ec.png"/></p> <p>Après avoir renseigné quelques menues informations (nom du projet, langue par défaut, &hellip;), le projet est créé et vous êtes redirigé(e) vers une modale qui vous explique quoi faire maintenant, c&#39;est à dire l&#39;ajout de la gem au <code>Gemfile</code> et le <code>bundle install</code> qu&#39;on vient de faire juste avant, mais surtout, ça nous propose d&#39;executer l&#39;instruction suivante qui sert à lier notre projet Locale à notre projet Middleman :</p> <div class=highlight><pre class="highlight shell"><code><span class="nv">$ </span>bundle <span class="nb">exec </span>localeapp <span class="nb">install</span> <span class="nt">--standalone</span> &lt;YOUR_API_KEY&gt;&#x000A;</code></pre></div> <p>Je vous laisse évidemment renseigner votre propre clef d&#39;API.</p> <p>Vous remarquez le switch <code>--standalone</code> ? Oui, c&#39;est parce qu&#39;on n&#39;utilise pas Rails, on n&#39;a donc pas besoin de tout un tas de trucs qui nous seraient inutiles des toutes façons. Donc économisons.</p> <h2 id=configuration-de-middleman>Configuration de Middleman</h2> <p>Voilà, donc la gem est maintenant configurée pour fonctionner avec notre projet Locale. En fait, ce qu&#39;il s&#39;est passé, c&#39;est que ça a créé un fichier <code>.localeapp/config.rb</code> à la racine de notre projet Middleman, avec dedans :</p> <div class=highlight><pre class="highlight ruby"><code><span class="no">Localeapp</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>&#x000A;  <span class="n">config</span><span class="p">.</span><span class="nf">api_key</span>                    <span class="o">=</span> <span class="s1">'&lt;YOUR_API_KEY&gt;'</span>&#x000A;  <span class="n">config</span><span class="p">.</span><span class="nf">translation_data_directory</span> <span class="o">=</span> <span class="s1">'locales'</span>&#x000A;  <span class="n">config</span><span class="p">.</span><span class="nf">synchronization_data_file</span>  <span class="o">=</span> <span class="s1">'.localeapp/log.yml'</span>&#x000A;  <span class="n">config</span><span class="p">.</span><span class="nf">daemon_pid_file</span>            <span class="o">=</span> <span class="s1">'.localeapp/localeapp.pid'</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div> <p>Il reste donc à dire 2 choses à Middleman : activer son module <code>i18n</code> et configurer la gem <code>localeapp</code> au démarrage. Il suffit pour ça d&#39;ajouter les lignes suivantes au fichier <code>config.rb</code> :</p> <div class=highlight><pre class="highlight ruby"><code><span class="n">activate</span> <span class="ss">:i18n</span><span class="p">,</span> <span class="ss">mount_at_root: :fr</span>&#x000A;<span class="nb">require</span> <span class="s1">'.localeapp/config'</span>&#x000A;</code></pre></div> <p>Ceux d&#39;entre vous qui sont déjà allé jeter un coup d&#39;oeil à la <a href="http://middlemanapp.com/advanced/localization/">doc i18n de Middleman</a>, auront remarqué que <code>mount_as_root: :fr</code> sert à définir le français comme langue par défaut. Vous faites comme vous voulez, ici, ça n&#39;a absolument pas besoin d&#39;être la même langue que celle définie comme langue par défaut dans Locale.</p> <p>La version française du site sera donc disponible, comme d&#39;habitude sur <a href="http://localhost:4567/en">http://localhost:4567</a> et la version anglaise sera, elle, disponible sur <a href="http://localhost:4567/en">http://localhost:4567/en</a> (notez le <code>/en</code> à la fin).</p> <h2 id=organisation-des-templates-middleman-et-utilisation-de-i18n>Organisation des templates Middleman et utilisation de I18n</h2> <p>Middleman sait quand générer des versions localisées des pages quand elles sont placées dans le dossier <code>source/localizable</code>, il suffit donc de déplacer, par exemple, votre <code>source/index.html.haml</code> dans <code>source/localized/index.html.haml</code>.</p> <p>Bien, maintenant, on peut utiliser, dans ce fichier, la classe Ruby I18n et notamment sa fonction <code>t</code> (ou <code>translate</code>), comme on le fait sous Rails (ici, en Haml) :</p> <div class=highlight><pre class="highlight haml"><code><span class="nt">%h1</span><span class="p">=</span> <span class="no">I18n</span><span class="p">.</span><span class="nf">t</span><span class="p">(</span><span class="s1">'index.title'</span><span class="p">)</span>&#x000A;</code></pre></div> <p>Ce qui devrait afficher &ldquo;Missing translation&rdquo;. Qu&#39;à celà ne tienne, on va aller la créer.</p> <h2 id=cr-ation-dune-traduction-dans-locale>Création d&#39;une traduction dans Locale</h2> <p>Sur la page de son projet, il suffit de cliquer sur une des langues, pour tomber sur la liste (vide, au début) des traductions.</p> <p>Cliquez donc sur le bouton &ldquo;+&rdquo; en haut pour en créer une nouvelle :</p> <p><img title="Locale - Create translation" alt="Locale - Create translation" width=1139 height=425 src="/images/blog/locale-03-create-translation-eaf1847f.png"/></p> <p>Une modale vous permettra alors de renseigner le chemin de la traduction :</p> <p><img title="Locale - Name new translation" alt="Locale - Name new translation" width=795 height=426 src="/images/blog/locale-04-create-translation-modal-bf9be83e.png"/></p> <p>Les chemins utilisent les points comme séparateurs, on crée donc, dans cet exemple, une traduction qui s&#39;appelle <code>title</code> dans le le noeud <code>index</code>, ce qui correspond à la clef que l&#39;on a précédemment passée à la fonction <code>t</code> du module Ruby <code>I18n</code> (faut suivre, hein&hellip;).</p> <p>Voilà, on peut maintenant remplir très intuitivement le contenu de cette traduction dans toutes les langues :</p> <p><img title="Locale - Fill in a translation" alt="Locale - Fill in a translation" width=1139 height=333 src="/images/blog/locale-05-fill-translation-feb7162f.png"/></p> <p>Il ne reste alors plus qu&#39;à ordonner à la gem de rappatrier les fichiers Yaml qui vont bien, et que Middleman saura lire en tapant dans la console :</p> <div class=highlight><pre class="highlight shell"><code><span class="nv">$ </span>localeapp pull&#x000A;</code></pre></div> <p>Dans notre exemple, les fichiers <code>locales/fr.yml</code> et <code>locales/en.yml</code> seront alors créés et prêts à être utilisés par Middleman (c&#39;est en fait eux qui sont appelés par la fonction Ruby <code>I18n.t()</code>).</p> <h3 id=bonus-pusher-des-traductions>Bonus: pusher des traductions</h3> <p>Vous vous doutez bien, si il y a un <code>localeapp pull</code>, c&#39;est qu&#39;il y a aussi un <code>localeapp push</code>. C&#39;est utile quand on a fait une modification directement dans un fichier Yaml (genre, lors d&#39;une résolution de conflit Git, et ça arrive souvent sur les fichiers Yaml) et que l&#39;on veut envoyer cette modification à Locale. On fait alors :</p> <div class=highlight><pre class="highlight shell"><code><span class="nv">$ </span>localeapp push locales/fr.yml&#x000A;</code></pre></div> <p>Oui, il faut spécifier quel fichier on pushe, c&#39;est pas la fête du slip, non plus.</p> <h3 id=bonus-2-i18n-locale>Bonus 2 : I18n.locale</h3> <p>Pour savoir quelle est la langue courante dynamiquement, tout comme sous Rails, on peut utiliser la variable Ruby <code>I18n.locale</code>, ce qui permet, par exemple de changer son Haml qui ressemblait à ça :</p> <div class=highlight><pre class="highlight haml"><code><span class="nt">%html</span><span class="p">{</span><span class="ss">lang: </span><span class="s1">'fr'</span><span class="p">}</span>&#x000A;</code></pre></div> <p>En ça, qui sera donc différent selon que la requête est pour la version française ou anglaise :</p> <div class=highlight><pre class="highlight haml"><code><span class="nt">%html</span><span class="p">{</span><span class="ss">lang: </span><span class="no">I18n</span><span class="p">.</span><span class="nf">locale</span><span class="p">}</span>&#x000A;</code></pre></div> <h4 id=sources>Sources</h4> <ul> <li>la <a href="http://middlemanapp.com/advanced/localization/">doc du module I18n</a> de Middleman</li> <li>les <a href="https://github.com/Locale/localeapp/wiki">wikis</a> de Locale sur GitHub</li> </ul> </div> <div class=author> Publié par <a href="https://twitter.com/michaelbaudino">Michael Baudino</a> <img alt='michael.baudino@alpine-lab.com' class=avatar src='https://www.gravatar.com/avatar/db878dfa87aec08092efcb7cc12ab343?size=128'> </div> </article> <aside> <h3>Autres articles récents</h3> <ul> <li><a href="/blog/utiliser-les-presences-de-phoenix/">Utiliser les Presences de Phoenix</a></li> <li><a href="/blog/des-helpers-pour-verifier-la-version-de-rails/">Des helpers pour vérifier la version de Rails</a></li> <li><a href="/blog/skiwallet-a-la-conference-blend/">SkiWallet à la conférence Blend</a></li> <li><a href="/blog/installer-git-flow-dans-une-box-nitrous-io/">Installer git-flow dans une box Nitrous.IO</a></li> <li><a href="/blog/git-en-couleurs/">Git en couleurs</a></li> <li><a href="/blog/generer-ses-vues-devise-en-haml/">Générer ses vues Devise en Haml</a></li> <li><a href="/blog/interdire-uniquement-l-enregistrement-de-nouveaux-utilisateurs-sous-devise/">Interdire uniquement l'enregistrement de nouveaux utilisateurs sous Devise</a></li> <li><a href="/blog/installer-font-awesome-sous-middleman/">Installer Font Awesome sous Middleman</a></li> <li><a href="/blog/un-alias-git-c-est-toujours-pratique/">Un alias git, c'est toujours pratique</a></li> </ul> </aside> </div> </div> <div id=corporate-btn> <a href="/">Alpine Lab <span class=caret></span> </a></div> <footer> <p> Le blog d'<a href="https://plus.google.com/+AlpineLab" rel=publisher>Alpine Lab</a> est publié sous license <a href="https://creativecommons.org/licenses/by/3.0/fr/">Creative Commons Attribution 3.0 (cc-by-3.0)</a>. Le code est sous licence <a href="https://opensource.org/licenses/MIT">MIT</a>. </p> </footer> </body> </html>